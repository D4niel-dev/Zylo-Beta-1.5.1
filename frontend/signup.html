<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>Zylo | Sign Up</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="icon" href="/images/zylo/Zylo_icon.ico" type="image/x-icon"/>
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#0d0d1a" />
  <script src="/files/vendor/tailwindcss.js"></script>
  <script src="/files/vendor/feather-icons.js"></script>
  <script src="/files/js/translations.js"></script>
  <link rel="stylesheet" href="/files/global.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            display: ['Sora', 'sans-serif'],
            body: ['DM Sans', 'sans-serif'],
          },
          animation: {
            fadeUp: 'fadeUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards',
            float: 'float 6s ease-in-out infinite',
          },
          keyframes: {
            fadeUp: {
              '0%': { opacity: '0', transform: 'translateY(30px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' }
            },
            float: {
              '0%, 100%': { transform: 'translateY(0px) rotate(0deg)' },
              '50%': { transform: 'translateY(-15px) rotate(3deg)' }
            }
          }
        }
      }
    };
  </script>
  <style>
    body {
      font-family: 'DM Sans', sans-serif;
      background: linear-gradient(145deg, #0d0d1a 0%, #1a1a2e 50%, #16213e 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: 
        radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 70% 80%, rgba(99, 102, 241, 0.05) 0%, transparent 50%),
        url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      pointer-events: none;
      z-index: -1;
    }
    .card-glass {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.05);
      border-radius: 1.5rem;
      transform: scale(0.95);
      transform-origin: top center;
    }
    .input-field {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .input-field:focus {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(16, 185, 129, 0.5);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }
    .btn-primary {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s ease;
    }
    .btn-primary:hover::before { left: 100%; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 40px -10px rgba(16, 185, 129, 0.5); }
    .btn-primary:disabled { transform: none; box-shadow: none; }
    .btn-secondary {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    .btn-secondary:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.2); }
    .btn-next {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    }
    .btn-next:hover { transform: translateY(-2px); box-shadow: 0 10px 40px -10px rgba(59, 130, 246, 0.5); }
    .floating-icon {
      position: absolute;
      opacity: 0.08;
      color: #10b981;
    }
    .wave-bottom {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      height: 120px;
      background: linear-gradient(0deg, rgba(16, 185, 129, 0.08) 0%, transparent 100%);
      pointer-events: none;
    }
    .step-indicator .step-circle {
      transition: all 0.3s ease;
    }
    .step-indicator.active .step-circle,
    .step-indicator.completed .step-circle {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border: none;
    }
    .progress-line {
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #3b82f6);
      transition: width 0.5s ease;
    }
    .social-btn {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.2s ease;
    }
    .social-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
    }
    .password-toggle:hover { color: #10b981; }
    .error-msg { color: #f87171; }
    .success-msg { color: #34d399; }
    /* Compact overrides */
    body { font-size: 14px; }
    .card-glass { padding: 1.5rem !important; max-width: 400px !important; }
    .input-field { padding: 0.5rem 0.75rem !important; font-size: 0.875rem !important; border-radius: 0.5rem !important; }
    .btn-primary, .btn-secondary, .btn-next { padding: 0.6rem 1rem !important; font-size: 0.875rem !important; border-radius: 0.5rem !important; }
    h1 { font-size: 1.5rem !important; margin-bottom: 0.5rem !important; }
    .step-circle { width: 2rem !important; height: 2rem !important; font-size: 0.75rem !important; }
    .step-indicator span { font-size: 0.65rem !important; margin-top: 0.25rem !important; }
    .floating-icon { transform: scale(0.6); }
    .social-btn img { width: 1.25rem !important; height: 1.25rem !important; }
    .progress-line { margin-top: 1rem !important; }
  </style>
  <script>
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark' || !savedTheme) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  </script>
</head>

<body class="min-h-screen flex flex-col justify-center items-center px-4 py-8 text-white">

  <!-- Floating Decorative Icons -->
  <div class="floating-icon animate-float" style="top: 10%; left: 8%; font-size: 3.5rem;">
    <i data-feather="user-plus"></i>
  </div>
  <div class="floating-icon animate-float" style="top: 50%; right: 8%; font-size: 3rem; animation-delay: -2s;">
    <i data-feather="star"></i>
  </div>
  <div class="floating-icon animate-float" style="bottom: 15%; left: 10%; font-size: 2.5rem; animation-delay: -4s;">
    <i data-feather="check-circle"></i>
  </div>

  <!-- Wave Bottom -->
  <div class="wave-bottom"></div>

  <!-- Language Picker -->
  <div class="absolute top-5 right-5 z-50">
    <select id="pageLanguageSelect" onchange="window.setLanguage(this.value)"
      class="bg-white/5 backdrop-blur-md text-gray-300 px-3 py-1.5 rounded-lg text-sm border border-white/10 focus:outline-none focus:border-emerald-400/50 cursor-pointer hover:bg-white/10 transition-colors">
      <option value="en" class="bg-gray-900">English</option>
      <option value="es" class="bg-gray-900">Español</option>
      <option value="vi" class="bg-gray-900">Tiếng Việt</option>
    </select>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="fixed top-5 right-5 z-50 transform transition-all duration-300 translate-x-full opacity-0">
    <div id="toastContent" class="card-glass text-white px-5 py-3 rounded-xl flex items-center gap-3 border-l-4 border-emerald-500">
      <i id="toastIcon" data-feather="check-circle" class="w-5 h-5 text-emerald-400"></i>
      <span id="toastMessage" class="font-medium text-sm">Notification</span>
    </div>
  </div>

  <!-- Header -->
  <div class="text-center mb-6 animate-fadeUp">
    <h1 class="font-display text-3xl lg:text-4xl font-bold tracking-tight" data-i18n="auth.createAccount">
      Create Your Account
    </h1>
    <p class="text-gray-400 mt-2 text-sm">Join the Zylo community today!</p>
  </div>

  <!-- Main Card -->
  <div class="w-full max-w-lg p-6 lg:p-8 card-glass animate-fadeUp" style="animation-delay: 0.1s;">

    <!-- Progress Indicator -->
    <div class="flex items-start mb-8 px-2" aria-label="Sign up progress">
      <div class="flex flex-col items-center step-indicator active" id="ind-1" aria-current="step">
        <div class="step-circle w-10 h-10 flex items-center justify-center rounded-full bg-white/10 text-gray-400 font-bold text-sm">1</div>
        <span class="text-[10px] mt-2 text-gray-500 uppercase font-semibold tracking-wide" data-i18n="auth.step.account">Account</span>
      </div>
      <div class="flex-1 mx-2 mt-4 progress-line"> <!-- Added mt-5 to align with circle center -->
        <div id="bar-1" class="progress-fill w-0"></div>
      </div>
      <div class="flex flex-col items-center step-indicator" id="ind-2">
        <div class="step-circle w-10 h-10 flex items-center justify-center rounded-full bg-white/10 text-gray-400 font-bold text-sm">2</div>
        <span class="text-[10px] mt-2 text-gray-500 uppercase font-semibold tracking-wide" data-i18n="auth.step.profile">Profile</span>
      </div>
      <div class="flex-1 mx-3 mt-5 progress-line">
        <div id="bar-2" class="progress-fill w-0"></div>
      </div>
      <div class="flex flex-col items-center step-indicator" id="ind-3">
        <div class="step-circle w-10 h-10 flex items-center justify-center rounded-full bg-white/10 text-gray-400 font-bold text-sm">3</div>
        <span class="text-[10px] mt-2 text-gray-500 uppercase font-semibold tracking-wide" data-i18n="auth.step.personal">Personal</span>
      </div>
      <div class="flex-1 mx-3 mt-5 progress-line">
        <div id="bar-3" class="progress-fill w-0"></div>
      </div>
      <div class="flex flex-col items-center step-indicator" id="ind-4">
        <div class="step-circle w-10 h-10 flex items-center justify-center rounded-full bg-white/10 text-gray-400 font-bold text-sm">4</div>
        <span class="text-[10px] mt-2 text-gray-500 uppercase font-semibold tracking-wide" data-i18n="auth.step.review">Review</span>
      </div>
    </div>

    <!-- Step 1: Account Creation -->
    <div id="step-1" class="step-content space-y-4">
      <div>
        <label class="block text-xs font-medium text-gray-400 uppercase tracking-wider mb-2">Username</label>
        <input id="newUsername" type="text" placeholder="Choose a username" data-i18n-placeholder="auth.username" aria-label="Username"
          class="input-field w-full px-4 py-3 rounded-xl text-white placeholder-gray-500 focus:outline-none">
        <p id="usernameAvail" role="alert" class="text-xs mt-1.5 hidden"></p>
      </div>
      <div>
        <label class="block text-xs font-medium text-gray-400 uppercase tracking-wider mb-2">Email</label>
        <input id="newEmail" type="email" placeholder="your@email.com" data-i18n-placeholder="auth.email" aria-label="Email"
          class="input-field w-full px-4 py-3 rounded-xl text-white placeholder-gray-500 focus:outline-none">
        <p id="emailAvail" role="alert" class="text-xs mt-1.5 hidden"></p>
      </div>
      <div>
        <label class="block text-xs font-medium text-gray-400 uppercase tracking-wider mb-2">Password</label>
        <div class="relative">
          <input id="newPassword" type="password" placeholder="Create a strong password" data-i18n-placeholder="auth.password" aria-label="Password"
            class="input-field password-field w-full px-4 py-3 pr-12 rounded-xl text-white placeholder-gray-500 focus:outline-none"/>
          <button type="button" class="password-toggle absolute top-1/2 -translate-y-1/2 right-4 text-gray-400 toggle-eye-wrapper">
            <i data-feather="eye" class="toggle-eye w-5 h-5"></i>
          </button>
        </div>
        <div id="pwStrength" class="text-xs mt-1.5" aria-live="polite"></div>
      </div>
      <div>
        <label class="block text-xs font-medium text-gray-400 uppercase tracking-wider mb-2">Confirm Password</label>
        <div class="relative">
          <input id="confirmPassword" type="password" placeholder="Confirm your password" data-i18n-placeholder="auth.confirmPassword" aria-label="Confirm Password"
            class="input-field password-field w-full px-4 py-3 pr-12 rounded-xl text-white placeholder-gray-500 focus:outline-none" />
          <button type="button" class="password-toggle absolute top-1/2 -translate-y-1/2 right-4 text-gray-400 toggle-eye-wrapper">
            <i data-feather="eye" class="toggle-eye w-5 h-5"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Step 2: Profile Setup -->
    <div id="step-2" class="step-content hidden space-y-4">
      <div class="relative text-center">
        <!-- Banner Preview -->
        <div role="button" tabindex="0" aria-label="Upload Banner" class="relative group cursor-pointer w-full" onclick="document.getElementById('bannerUpload').click()">
          <img id="bannerPreview" src="/images/default_banner.png" alt="Banner Preview"
            class="w-full h-32 object-cover rounded-xl border-2 border-dashed border-white/20 group-hover:border-emerald-500/50 transition-colors">
          <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity rounded-xl">
            <span class="text-white font-medium text-sm flex items-center gap-2"><i data-feather="image" class="w-4 h-4"></i> Change Banner</span>
          </div>
        </div>
        <input type="file" id="bannerUpload" accept="image/*" class="hidden" onchange="previewImage(event, 'bannerPreview')" aria-label="Upload Banner File">

        <!-- Avatar Preview -->
        <div class="relative -mt-12 inline-block">
          <label for="avatarUpload" role="button" tabindex="0" aria-label="Upload Avatar" class="cursor-pointer group relative block">
            <img id="avatarPreview" src="/images/default_avatar.png" alt="Avatar Preview"
              class="w-24 h-24 rounded-full shadow-xl ring-4 ring-gray-900 object-cover bg-gray-900 group-hover:brightness-75 transition-all" />
            <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity rounded-full">
              <i data-feather="camera" class="text-white w-6 h-6"></i>
            </div>
          </label>
          <input type="file" id="avatarUpload" accept="image/*" class="hidden" onchange="previewImage(event, 'avatarPreview')" aria-label="Upload Avatar File">
        </div>
      </div>

      <div class="pt-4">
        <label class="block text-xs font-medium text-gray-400 uppercase tracking-wider mb-2">Usertag (optional)</label>
        <input id="usertag" type="text" placeholder="@yourtag" data-i18n-placeholder="auth.usertag" aria-label="Usertag (optional)"
          class="input-field w-full px-4 py-3 rounded-xl text-white placeholder-gray-500 focus:outline-none text-center">
        <p class="text-xs text-gray-500 text-center mt-1">Leave empty for a random tag</p>
      </div>
    </div>

    <!-- Step 3: Personal Details -->
    <div id="step-3" class="step-content hidden space-y-4">
      <div>
        <label class="block text-xs font-medium text-gray-400 uppercase tracking-wider mb-2">Phone Number (optional)</label>
        <input id="phone" type="text" placeholder="+1 (555) 123-4567" data-i18n-placeholder="auth.phone" aria-label="Phone Number (optional)"
          class="input-field w-full px-4 py-3 rounded-xl text-white placeholder-gray-500 focus:outline-none">
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-xs font-medium text-gray-400 uppercase tracking-wider mb-2">Date of Birth</label>
          <input id="dob" type="date" aria-label="Date of Birth"
            class="input-field w-full px-4 py-3 rounded-xl text-white focus:outline-none">
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-400 uppercase tracking-wider mb-2">Gender</label>
          <select id="gender" aria-label="Gender" class="input-field w-full px-4 py-3 rounded-xl text-white focus:outline-none">
            <option value="" class="bg-gray-900" data-i18n="auth.gender">Select</option>
            <option value="male" class="bg-gray-900" data-i18n="auth.gender.male">Male</option>
            <option value="female" class="bg-gray-900" data-i18n="auth.gender.female">Female</option>
            <option value="other" class="bg-gray-900" data-i18n="auth.gender.other">Other</option>
          </select>
        </div>
      </div>
      <p class="text-xs text-gray-500 text-center">These details help personalize your experience but are not required.</p>
    </div>

    <!-- Step 4: Review & Terms -->
    <div id="step-4" class="step-content hidden space-y-5 text-center">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-emerald-500/10 mb-2">
        <i data-feather="check-circle" class="w-8 h-8 text-emerald-400"></i>
      </div>
      <h3 class="font-display text-xl font-semibold" data-i18n="auth.almostThere">Almost there!</h3>
      <p class="text-sm text-gray-400">
        Please review the 
        <button onclick="openModal('tos')" class="text-emerald-400 hover:text-emerald-300 underline" data-i18n="auth.termsOfService">Terms of Service</button> and 
        <button onclick="openModal('pp')" class="text-emerald-400 hover:text-emerald-300 underline" data-i18n="auth.privacyPolicy">Privacy Policy</button>
      </p>
      <div class="flex items-center justify-center gap-3 p-4 bg-white/5 rounded-xl">
        <input type="checkbox" id="agreeTerms" class="accent-emerald-500 w-5 h-5" aria-label="I agree to the Terms">
        <span class="text-sm text-gray-300" data-i18n="auth.agreeTerms">I agree to the Terms & Privacy Policy</span>
      </div>
      <button id="signupBtn" onclick="register()" aria-label="Create Account"
        class="btn-primary w-full py-3.5 rounded-xl font-semibold text-white flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
        <svg id="signupSpinner" class="w-5 h-5 animate-spin hidden" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" class="opacity-25"/>
          <path d="M4 12a8 8 0 018-8" stroke="currentColor" stroke-width="4" class="opacity-75"/>
        </svg>
        <span id="signupBtnText" data-i18n="auth.createAccount">Create Account</span>
      </button>
    </div>

    <!-- Navigation Buttons -->
    <div class="flex gap-3 mt-6 pt-6 border-t border-white/5">
      <button id="prevBtn" onclick="changeStep(-1)" aria-label="Go to previous step"
        class="flex-1 btn-secondary py-3 rounded-xl font-medium text-gray-300 hidden" data-i18n="auth.back">Back</button>
      <button id="nextBtn" onclick="changeStep(1)" aria-label="Go to next step"
        class="flex-1 btn-next py-3 rounded-xl font-semibold text-white" data-i18n="auth.next">Next</button>
    </div>

    <!-- Error Message -->
    <p id="signup-error" role="alert" class="error-msg text-sm text-center mt-4 hidden"></p>

    <!-- Social Login (Step 1 only) -->
    <div id="social-login-container" class="mt-6">
      <div class="flex items-center gap-3 text-sm text-gray-500 mb-4">
        <hr class="flex-grow border-white/10" />
        <span data-i18n="auth.orSignUpWith">or sign up with</span>
        <hr class="flex-grow border-white/10" />
      </div>
      <div class="grid grid-cols-4 gap-3">
        <button onclick="socialLogin('Google')" aria-label="Sign up with Google" class="social-btn p-3 rounded-xl flex justify-center">
          <img src="/images/devicons/google-original.svg" alt="Google" class="w-5 h-5" />
        </button>
        <button onclick="socialLogin('GitHub')" aria-label="Sign up with GitHub" class="social-btn p-3 rounded-xl flex justify-center">
          <img src="/images/devicons/github-original.svg" alt="GitHub" class="w-5 h-5" />
        </button>
        <button onclick="socialLogin('Discord')" aria-label="Sign up with Discord" class="social-btn p-3 rounded-xl flex justify-center">
          <img src="/images/devicons/discordjs-original.svg" alt="Discord" class="w-5 h-5" />
        </button>
        <button onclick="socialLogin('Microsoft')" aria-label="Sign up with Microsoft" class="social-btn p-3 rounded-xl flex justify-center">
          <img src="/images/devicons/windows8-original.svg" alt="Microsoft" class="w-5 h-5" />
        </button>
      </div>
    </div>

    <!-- Login Link -->
    <div class="text-center text-sm mt-6 pt-6 border-t border-white/5">
      <span class="text-gray-500" data-i18n="auth.haveAccount">Already have an account?</span>
      <a href="login.html" class="text-emerald-400 hover:text-emerald-300 ml-1 transition-colors" data-i18n="auth.loginHere">Login here</a>
    </div>
  </div>

  <!-- Email Verification Modal -->
  <div id="verificationModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 hidden flex items-center justify-center px-4" role="dialog" aria-labelledby="verificationTitle" aria-modal="true">
    <div class="card-glass max-w-md w-full p-8">
      <div class="text-center mb-6">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-emerald-500/10 mb-4">
          <i data-feather="mail" class="w-8 h-8 text-emerald-400"></i>
        </div>
        <h3 id="verificationTitle" class="font-display text-xl font-bold">Verify Your Email</h3>
        <p class="text-sm text-gray-400 mt-2">Enter the 6-digit code sent to your email</p>
      </div>
      <input type="text" id="verificationCodeInput" maxlength="6" placeholder="000000" aria-label="Verification Code"
        class="input-field w-full text-center text-2xl font-mono tracking-[0.5em] py-4 rounded-xl focus:outline-none"/>
      <p id="verificationError" role="alert" class="error-msg text-sm text-center mt-3 hidden"></p>
      <button id="verifyCodeBtn" onclick="verifyEmailCode()" aria-label="Verify Email"
        class="btn-primary w-full mt-5 py-3 rounded-xl font-semibold text-white flex items-center justify-center gap-2">
        <svg id="verifySpinner" class="w-5 h-5 animate-spin hidden" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" class="opacity-25"/>
          <path d="M4 12a8 8 0 018-8" stroke="currentColor" stroke-width="4" class="opacity-75"/>
        </svg>
        <span id="verifyBtnText">Verify Email</span>
      </button>
      <button onclick="resendVerificationCode()" class="w-full mt-3 py-2 text-emerald-400 hover:text-emerald-300 text-sm transition-colors">Resend Code</button>
      <button onclick="skipVerification()" class="w-full mt-1 py-2 text-gray-500 hover:text-gray-400 text-xs transition-colors">Skip for now</button>
    </div>
  </div>

  <!-- Terms/Privacy Modal -->
  <div id="modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 hidden flex items-center justify-center px-4" aria-modal="true" role="dialog" aria-labelledby="modalTitle">
    <div class="card-glass max-w-2xl w-full p-6 max-h-[80vh] overflow-hidden flex flex-col">
      <div class="flex justify-between items-center mb-4">
        <h3 id="modalTitle" class="font-display text-xl font-semibold">Document</h3>
        <button onclick="closeModal()" aria-label="Close Modal" class="text-gray-400 hover:text-white transition-colors">
          <i data-feather="x" class="w-5 h-5"></i>
        </button>
      </div>
      <pre id="modalContent" class="text-sm text-gray-300 whitespace-pre-wrap overflow-y-auto flex-1"></pre>
    </div>
  </div>

  <!-- Coming Soon Modal -->
  <div id="comingSoonModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 hidden flex items-center justify-center px-4" aria-modal="true" role="dialog">
    <div class="card-glass max-w-sm w-full p-6 text-center">
      <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-amber-500/10 mb-4">
        <i data-feather="tool" class="w-6 h-6 text-amber-400"></i>
      </div>
      <h3 class="font-display text-lg font-semibold mb-2">Coming Soon</h3>
      <p id="comingSoonText" class="text-gray-400 text-sm mb-5">This feature will be added in a future update!</p>
      <button onclick="closeComingSoon()" class="btn-primary px-6 py-2 rounded-xl font-medium text-white">Got it</button>
    </div>
  </div>

  <!-- All JavaScript preserved exactly from original -->
  <script>
    let currentStep = 1;

    updateStepUI();
    if(window.applyLanguage) window.applyLanguage(localStorage.getItem('language') || 'en');

    function changeStep(n) {
      const nextStep = currentStep + n;
      if (n > 0) {
        if (currentStep === 1 && !validateStep1()) return;
      }
      currentStep = nextStep;
      updateStepUI();
    }

    function updateStepUI() {
      document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
      document.getElementById(`step-${currentStep}`).classList.remove('hidden');

      for (let i = 1; i < 4; i++) {
        const bar = document.getElementById(`bar-${i}`);
        bar.style.width = currentStep > i ? '100%' : '0%';
      }

      for (let i = 1; i <= 4; i++) {
        const indicatorWrapper = document.getElementById(`ind-${i}`);
        indicatorWrapper.classList.remove('active', 'completed');
        if (i === currentStep) {
          indicatorWrapper.classList.add('active');
          indicatorWrapper.setAttribute('aria-current', 'step');
        } else if (i < currentStep) {
          indicatorWrapper.classList.add('completed');
          indicatorWrapper.removeAttribute('aria-current');
        } else {
          indicatorWrapper.removeAttribute('aria-current');
        }
      }

      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const socialLogin = document.getElementById('social-login-container');

      prevBtn.classList.toggle('hidden', currentStep === 1);
      socialLogin.classList.toggle('hidden', currentStep !== 1);
      nextBtn.classList.toggle('hidden', currentStep === 4);
    }

    function validateStep1() {
      const username = document.getElementById('newUsername').value.trim();
      const email = document.getElementById('newEmail').value.trim();
      const pw = document.getElementById('newPassword').value;
      const cpw = document.getElementById('confirmPassword').value;

      if (!username || !email || !pw || !cpw) {
        showError("Please fill in all required fields.");
        return false;
      }
      if (pw !== cpw) {
        showError("Passwords do not match.");
        return false;
      }
      if (!email.includes('@')) {
        showError("Please enter a valid email.");
        return false;
      }
      const availText = document.getElementById('usernameAvail').textContent;
      if (availText.includes('taken')) {
        showError("Username is already taken.");
        return false;
      }
      return true;
    }

    function showError(msg) {
      const err = document.getElementById("signup-error");
      err.textContent = msg;
      err.classList.remove("hidden");
    }

    function showToast(msg, type='success') {
      const toast = document.getElementById('toast');
      const content = document.getElementById('toastContent');
      const msgEl = document.getElementById('toastMessage');
      const iconEl = document.getElementById('toastIcon');

      msgEl.textContent = msg;
      content.classList.remove('border-emerald-500', 'border-red-500');
      if(type === 'error'){
        content.classList.add('border-red-500');
        iconEl.setAttribute('data-feather', 'alert-circle');
        iconEl.classList.remove('text-emerald-400');
        iconEl.classList.add('text-red-400');
      } else {
        content.classList.add('border-emerald-500');
        iconEl.setAttribute('data-feather', 'check-circle');
        iconEl.classList.remove('text-red-400');
        iconEl.classList.add('text-emerald-400');
      }
      feather.replace();

      toast.classList.remove('translate-x-full', 'opacity-0');
      setTimeout(() => { toast.classList.add('translate-x-full', 'opacity-0'); }, 3000);
    }

    document.addEventListener('click', (e) => {
      if (e.target.closest('.toggle-eye-wrapper')) {
        e.preventDefault();
        const container = e.target.closest('.relative');
        const input = container ? container.querySelector('input.password-field') : null;
        const icon = container ? container.querySelector('.toggle-eye') : null;
        if (!input || !icon) return;
        const willShow = input.type !== 'text';
        input.type = willShow ? 'text' : 'password';
        icon.setAttribute('data-feather', willShow ? 'eye-off' : 'eye');
        feather.replace();
      }
    });

    feather.replace();

    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark');
    }

    const newUsername = document.getElementById('newUsername');
    const usernameAvail = document.getElementById('usernameAvail');
    const newEmail = document.getElementById('newEmail');
    const emailAvail = document.getElementById('emailAvail');
    const newPassword = document.getElementById('newPassword');
    const pwStrength = document.getElementById('pwStrength');

    let checkTimer, emailCheckTimer;

    newUsername?.addEventListener('input', () => {
      usernameAvail.classList.add('hidden');
      clearTimeout(checkTimer);
      const value = (newUsername.value || '').trim();
      if (!value) return;
      checkTimer = setTimeout(async () => {
        try {
          const res = await fetch(`/api/check-user?identifier=${encodeURIComponent(value)}`);
          const data = await res.json();
          usernameAvail.textContent = data.exists ? 'Username already taken' : 'Username available';
          usernameAvail.className = `text-xs mt-1.5 ${data.exists ? 'error-msg' : 'success-msg'}`;
          usernameAvail.classList.remove('hidden');
        } catch {}
      }, 350);
    });

    newEmail?.addEventListener('input', () => {
      emailAvail.classList.add('hidden');
      clearTimeout(emailCheckTimer);
      const value = (newEmail.value || '').trim();
      if (!value || !value.includes('@')) return;
      emailCheckTimer = setTimeout(async () => {
        try {
          const res = await fetch(`/api/check-user?identifier=${encodeURIComponent(value)}`);
          const data = await res.json();
          emailAvail.textContent = data.exists ? 'Email already registered' : 'Email available';
          emailAvail.className = `text-xs mt-1.5 ${data.exists ? 'error-msg' : 'success-msg'}`;
          emailAvail.classList.remove('hidden');
        } catch {}
      }, 350);
    });

    function calcStrength(pw){
      let score = 0;
      if (pw.length >= 8) score++;
      if (/[A-Z]/.test(pw)) score++;
      if (/[a-z]/.test(pw)) score++;
      if (/\d/.test(pw)) score++;
      if (/[^\w\s]/.test(pw)) score++;
      return score;
    }

    newPassword?.addEventListener('input', () => {
      const pw = newPassword.value || '';
      const s = calcStrength(pw);
      const labels = ['Very weak','Weak','Okay','Good','Strong'];
      const colors = ['#ef4444', '#f97316', '#eab308', '#84cc16', '#22c55e'];
      pwStrength.textContent = pw ? `Strength: ${labels[Math.max(0, s-1)]}` : '';
      pwStrength.style.color = colors[Math.max(0, s-1)] || colors[0];
    });

    function previewImage(event, targetId) {
      const reader = new FileReader();
      reader.onload = () => document.getElementById(targetId).src = reader.result;
      reader.readAsDataURL(event.target.files[0]);
    }

    async function encodeImageToBase64(inputId) {
      const fileInput = document.getElementById(inputId);
      if (fileInput.files.length === 0) return null;
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.readAsDataURL(fileInput.files[0]);
      });
    }

    function goToPage(href) {
      document.body.style.opacity = '0';
      document.body.style.transition = 'opacity 0.4s ease';
      setTimeout(() => { window.location.href = href; }, 400);
    }

    document.querySelectorAll("a").forEach(link => {
      if (link.hostname === window.location.hostname && link.getAttribute('href') !== '#') {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          goToPage(this.getAttribute("href"));
        });
      }
    });

    function showComingSoon(provider) {
      document.getElementById("comingSoonText").textContent = `${provider} sign-up will be added in the next update!`;
      document.getElementById("comingSoonModal").classList.remove("hidden");
    }
    function closeComingSoon() {
      document.getElementById("comingSoonModal").classList.add("hidden");
    }

    async function socialLogin(provider) {
      const error = document.getElementById("signup-error");
      error.classList.add("hidden");
      try { new Audio('/files/audio/click.mp3').play().catch(()=>{}); } catch {}
      document.body.classList.add("cursor-wait");

      try {
        const res = await fetch('/api/auth/social', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ provider })
        });
        const data = await res.json();
        if (data.success) {
          localStorage.setItem("username", data.username);
          localStorage.setItem("usertag", data.usertag);
          try { new Audio('/files/audio/login.mp3').play().catch(()=>{}); } catch {}
          goToPage("loading.html");
        } else {
          error.textContent = data.error || "Login failed";
          error.classList.remove("hidden");
          document.body.classList.remove("cursor-wait");
        }
      } catch (e) {
        error.textContent = "Network error. Try again.";
        error.classList.remove("hidden");
        document.body.classList.remove("cursor-wait");
      }
    }

    async function register() {
      const username = document.getElementById("newUsername").value.trim();
      const email = document.getElementById("newEmail").value.trim();
      const password = document.getElementById("newPassword").value.trim();
      const confirm = document.getElementById("confirmPassword").value.trim();
      let usertag = document.getElementById("usertag").value.trim();
      const dob = document.getElementById("dob").value;
      const gender = document.getElementById("gender").value;
      const phone = document.getElementById("phone").value;
      const agree = document.getElementById("agreeTerms").checked;
      const error = document.getElementById("signup-error");
      const signupBtn = document.getElementById('signupBtn');
      const signupSpinner = document.getElementById('signupSpinner');
      const signupBtnText = document.getElementById('signupBtnText');

      if (password !== confirm) {
        error.textContent = "Passwords do not match.";
        error.classList.remove("hidden");
        return;
      }
      if (!agree) {
        error.textContent = "You must agree to the Privacy Policy and Terms of Service.";
        error.classList.remove("hidden");
        return;
      }
      if (!usertag) {
        usertag = `${username.toLowerCase()}${Math.floor(1000 + Math.random() * 9000)}`;
      }

      signupBtn.disabled = true;
      signupSpinner.classList.remove('hidden');
      signupBtnText.textContent = 'Creating account…';

      const avatar = await encodeImageToBase64("avatarUpload");
      const banner = await encodeImageToBase64("bannerUpload");

      const response = await fetch(`${window.location.origin}/api/signup`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, email, password, usertag, dob, gender, phone, avatar, banner }),
      });

      const result = await response.json();
      if (result.success) {
        localStorage.setItem("username", username);
        localStorage.setItem("usertag", usertag);
        localStorage.setItem("pendingVerification", "true");
        document.getElementById("verificationModal").classList.remove("hidden");
        document.getElementById("verificationCodeInput").focus();
        try { new Audio('/files/audio/login.mp3').play().catch(()=>{}); } catch {}
        feather.replace();
        signupBtn.disabled = false;
        signupSpinner.classList.add('hidden');
        signupBtnText.textContent = 'Create Account';
      } else {
        error.textContent = result.error || "Signup failed.";
        error.classList.remove("hidden");
        try { new Audio('/files/audio/error.mp3').play().catch(()=>{}); } catch {}
        signupBtn.disabled = false;
        signupSpinner.classList.add('hidden');
        signupBtnText.textContent = 'Create Account';
      }
    }

    document.addEventListener("keydown", function (event) {
      if (event.key === "Enter") {
        if (currentStep === 4) register();
        else if (currentStep < 4) changeStep(1);
      }
    });

    setInterval(() => { if (window.feather) feather.replace(); }, 2000);

    async function verifyEmailCode() {
      const code = document.getElementById("verificationCodeInput").value.trim();
      const username = localStorage.getItem("username");
      const errorEl = document.getElementById("verificationError");
      const btn = document.getElementById("verifyCodeBtn");
      const spinner = document.getElementById("verifySpinner");
      const btnText = document.getElementById("verifyBtnText");

      if (!code || code.length !== 6) {
        errorEl.textContent = "Please enter a 6-digit code.";
        errorEl.classList.remove("hidden");
        return;
      }

      btn.disabled = true;
      spinner.classList.remove("hidden");
      btnText.textContent = "Verifying...";
      errorEl.classList.add("hidden");

      try {
        const res = await fetch("/api/auth/verify-email", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, code })
        });
        const data = await res.json();

        if (data.success) {
          localStorage.removeItem("pendingVerification");
          try { new Audio('/files/audio/login.mp3').play().catch(()=>{}); } catch {}
          showToast("Email verified! Redirecting...", "success");
          setTimeout(() => { goToPage("login.html"); }, 1500);
        } else {
          errorEl.textContent = data.error || "Invalid code.";
          errorEl.classList.remove("hidden");
          try { new Audio('/files/audio/error.mp3').play().catch(()=>{}); } catch {}
        }
      } catch (e) {
        errorEl.textContent = "Network error.";
        errorEl.classList.remove("hidden");
      }

      btn.disabled = false;
      spinner.classList.add("hidden");
      btnText.textContent = "Verify Email";
    }

    async function resendVerificationCode() {
      const username = localStorage.getItem("username");
      try {
        const res = await fetch("/api/auth/resend-verification", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username })
        });
        const data = await res.json();
        if (data.success) {
          showToast("Verification code resent!", "success");
        } else {
          showToast(data.error || "Failed to resend code.", "error");
        }
      } catch (e) {
        showToast("Network error.", "error");
      }
    }

    function skipVerification() {
      document.getElementById("verificationModal").classList.add("hidden");
      localStorage.removeItem("pendingVerification");
      goToPage("login.html");
    }

    function openModal(type) {
      const title = type === "pp" ? "Privacy Policy" : "Terms of Service";
      const content = type === "pp" ? zyloPP : zyloTOS;
      document.getElementById("modalTitle").textContent = title;
      document.getElementById("modalContent").textContent = content;
      document.getElementById("modal").classList.remove("hidden");
    }

    function closeModal() {
      document.getElementById("modal").classList.add("hidden");
    }

    const zyloPP = `Privacy Policy - Last Updated: July 2025

This Privacy Policy explains how Zylo collects, uses, and protects your information.

1. Information We Collect
- Account Information: name, email, credentials
- Usage Data: pages visited, features used
- Cookies: to enhance your experience

2. How We Use Your Information
- Provide and improve Zylo
- Personalize your experience
- Communicate with you
- Ensure security

3. We do not sell your personal information.

4. Contact: zylosupp0rt@gmail.com`;

    const zyloTOS = `Terms of Service - Last Updated: July 2025

By using Zylo, you agree to these terms.

1. You must be at least 13 years old.
2. Use Zylo only for lawful purposes.
3. You are responsible for your account security.
4. Do not interfere with or disrupt the Service.
5. All content is property of Zylo or its licensors.
6. Zylo is provided "as is".

Contact: zylosupp0rt@gmail.com`;
  </script>
  <script>feather.replace();</script>
  <script src="/files/sw-register.js"></script>
</body>
</html>